# Maintainer: Bobby Hamblin <hamblingreen at hotmail dot com>
# Contributor: Miles Alan <m@milesalan.com>

pkgname=fbp
pkgver=0.6
pkgrel=1
pkgdesc="Framebuffer linux phone UI environment, supported best on the Pinephone"
arch=('aarch64' 'x86_64')
url="https://git.sr.ht/~hamblingreen/fbp"
license=('GPL-3.0-or-later')
makedepends=('zig>=0.12.0' 'stb' 'linux-headers')
source=(
"https://git.sr.ht/~hamblingreen/fbp/archive/$pkgver.tar.gz"
"$pkgname.install"
"$pkgname.service"
"$pkgname.init"
)
sha256sums=('d95c4027cbfa7f4962382d6abc9778b50bf20e4f18b070b8b729f2d2979e7b5d'
            '26df5f0045163e72b044627b9836dfffa54db1e0573551b46e5db1798599b7fb'
            '611974c529c60deab55c89c54603593292602cc79f5e7a3e7ab71ca6ea36d4af'
            '102cb4f5ee49f92fbe71d1a5ce50eea55fb03979531d80093b147d838ec8c7ad')

build() {
	cd "$pkgname-$pkgver"
	zig build -Doptimize=ReleaseFast
}

package() {
	#Load 'uinput' kernel module at boot
	mkdir -p "$pkgdir/etc/modules-load.d/"
	install "fbp.init" "$pkgdir/etc/modules-load.d/fbp.conf"

	#Create systemd service to start fbp on boot
	mkdir -p "$pkgdir/usr/lib/systemd/system/"
	install "fbp.service" "$pkgdir/usr/lib/systemd/system/fbp.service"

	#Enable fbp service
	install=fbp.install

	cd "$pkgname-$pkgver"

	#Install fbp binary
	mkdir -p "$pkgdir/usr/bin"
	install "zig-out/bin/fbp" "$pkgdir/usr/bin"
}
